## Migration Scripts

### `main.py` – Cloudinary → Linode Object Storage

- **Purpose**:  
  Migrates all image assets from Cloudinary to Linode Object Storage and creates a JSON mapping of old → new URLs.

- **What it does**:

  - Fetches all `image` resources from your Cloudinary account (paginated).
  - Downloads each image to a local `assets/` folder.
  - Uploads each image to your Linode Object Storage bucket.
  - Makes uploaded objects **public** (`ACL='public-read'`).
  - Saves / updates `url_mapping.json` with:
    - key: original Cloudinary URL
    - value: new Linode URL
  - Can be safely **resumed**:
    - Re-runs will skip already migrated images based on `url_mapping.json`.

- **Environment variables required** (in `.env`):

  - `CLOUDINARY_CLOUD_NAME`
  - `CLOUDINARY_API_KEY`
  - `CLOUDINARY_API_SECRET`
  - `LINODE_ACCESS_KEY`
  - `LINODE_SECRET_KEY`
  - `LINODE_BUCKET`
  - `LINODE_REGION`

- **How to run**:
  ```bash
  cd /Users/newuser/Documents/Projects/Yanga/Hersi/migration
  source venv/bin/activate
  python main.py
  ```
  You will be shown:
  - Total Cloudinary images found
  - A confirmation prompt before bulk transfer
  - Progress logs and a final summary (success / skipped / failed).

---

### `migrate_claudinary_firebase.py` – Firestore URL Updater

- **Purpose**:  
  Updates Firestore documents so that all Cloudinary image URLs are replaced with the new Linode URLs from `url_mapping.json`.

- **What it does**:

  - Loads `url_mapping.json` produced by `main.py`.
  - Initializes Firebase Admin SDK using `firebase_admin.json` service account.
  - Scans the `news` collection in Firestore.
  - For each document:
    - Rewrites the `image` field (string) if it contains a Cloudinary URL.
    - Rewrites the `content` field (HTML) by replacing any embedded Cloudinary URLs in `<img src="...">` with the mapped Linode URLs.
  - Only updates documents where a change is actually needed.

- **Files required**:

  - `firebase_admin.json` – Firebase service account credentials.
  - `url_mapping.json` – Cloudinary → Linode URL map generated by `main.py`.

- **How to run**:
  ```bash
  cd /Users/newuser/Documents/Projects/Yanga/Hersi/migration
  source venv/bin/activate
  python migrate_claudinary_firebase.py
  ```
  The script will print:
  - How many `news` documents were scanned.
  - How many were updated with new image URLs.
